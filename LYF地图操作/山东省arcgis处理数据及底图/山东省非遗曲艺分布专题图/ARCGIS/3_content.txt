-- 创建非遗餐饮表CREATE TABLE intangible_heritage_food (    food_id INT IDENTITY(1,1) PRIMARY KEY,    food_name VARCHAR(200) NOT NULL,           -- 餐饮项目名称    food_type VARCHAR(50) NOT NULL,            -- 餐饮类型：餐厅、街边小吃、食品店、作坊等    heritage_id INT,                           -- 关联的非遗项目ID    location VARCHAR(300),                     -- 餐饮地点    province VARCHAR(50) DEFAULT '山东省',      -- 省份    city VARCHAR(50),                          -- 城市    district VARCHAR(100),                     -- 区县    address VARCHAR(500),                      -- 详细地址    rating DECIMAL(3,2),                       -- 评价分数（1-5分）    rating_count INT DEFAULT 0,                -- 评价人数    price_range VARCHAR(50),                   -- 价格范围    special_features TEXT,                     -- 特色介绍    contact_phone VARCHAR(20),                 -- 联系电话    opening_hours VARCHAR(100),                -- 营业时间    is_recommended INT DEFAULT 0,              -- 是否推荐：0-否，1-是    status VARCHAR(20) DEFAULT '营业中',       -- 状态：营业中、歇业、搬迁等    created_time DATETIME DEFAULT GETDATE(),    updated_time DATETIME DEFAULT GETDATE(),        FOREIGN KEY (heritage_id) REFERENCES intangible_cultural_heritage(heritage_id));GO-- 为非遗餐饮表创建索引CREATE INDEX idx_food_name ON intangible_heritage_food(food_name);CREATE INDEX idx_food_type ON intangible_heritage_food(food_type);CREATE INDEX idx_food_location ON intangible_heritage_food(city, district);CREATE INDEX idx_food_heritage ON intangible_heritage_food(heritage_id);CREATE INDEX idx_food_rating ON intangible_heritage_food(rating DESC);GO-- 插入非遗餐饮数据（约20项）-- 注：部分非遗项目可能没有具体的餐饮实体，这里根据非遗项目类型和地区创建相应的餐饮项目-- 1. 德州扒鸡 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('德州扒鸡专卖店', '食品店',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%德州扒鸡%' AND category_id = (SELECT category_id FROM categories WHERE category_name = '传统技艺')), '德州市德城区', '德州市', '德城区', '德城区解放中大道123号', 4.5, 1280, '25-80元', '德州扒鸡是山东省德州市的传统名吃，采用传统制作技艺，色泽金黄，肉质鲜嫩，五香脱骨，是德州三宝之一。', '0534-1234567', '08:00-20:00', 1);-- 2. 周村烧饼 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('周村烧饼老店', '食品店',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%周村烧饼%'), '淄博市周村区', '淄博市', '周村区', '周村区大街128号', 4.7, 2150, '10-50元', '周村烧饼制作技艺是国家级非遗，薄如秋叶，形似满月，落地珠散玉碎，入口回味无穷。', '0533-2345678', '07:30-19:30', 1);-- 3. 孔府菜 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('孔府宴餐厅', '餐厅',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%孔府菜%'), '济宁市曲阜市', '济宁市', '曲阜市', '曲阜市鼓楼北街18号', 4.8, 890, '150-800元', '孔府菜烹饪技艺是省级非遗，以选料精良、制作精细、注重营养、讲究礼仪而闻名，是儒家饮食文化的代表。', '0537-3456789', '11:00-14:00, 17:00-21:00', 1);-- 4. 东阿阿胶 - 传统医药类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('东阿阿胶养生坊', '食品店',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%东阿阿胶制作技艺%'), '聊城市东阿县', '聊城市', '东阿县', '东阿县阿胶街78号', 4.6, 1560, '200-2000元', '东阿阿胶制作技艺是国家级非遗，具有三千年历史，补血滋阴，润燥止血，是传统滋补上品。', '0635-4567890', '08:30-18:30', 1);-- 5. 泰山豆腐宴 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('泰山豆腐宴餐厅', '餐厅',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%豆腐传统制作技艺%'), '泰安市泰山区', '泰安市', '泰山区', '泰山区红门路56号', 4.4, 720, '80-300元', '泰山豆腐宴是省级非遗，以泰山豆腐为主料，可制作150多道豆腐菜肴，是泰山饮食文化的代表。', '0538-5678901', '10:30-21:00', 1);-- 6. 景芝酒 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('景芝酒文化体验馆', '酒馆',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%景芝酒%'), '潍坊市安丘市', '潍坊市', '安丘市', '安丘市景芝镇景酒大道1号', 4.3, 430, '50-500元', '景芝酒传统酿造技艺是国家级非遗，有五千余年酿酒历史，芝麻香型白酒的代表。', '0536-6789012', '09:00-17:00', 0);-- 7. 亓氏酱香源 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('亓氏酱香源卤味店', '食品店',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%亓氏酱香源%'), '济南市莱芜区', '济南市', '莱芜区', '莱芜区凤城西大街45号', 4.2, 980, '30-150元', '亓氏酱香源肉食酱制技艺是省级非遗，百年老字号，酱香浓郁，肉质酥烂，回味悠长。', '0634-7890123', '08:00-19:00', 0);-- 8. 龙口粉丝 - 传统技艺类INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('龙口粉丝专卖', '食品店',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%龙口粉丝%'), '烟台市招远市', '烟台市', '招远市', '招远市金岭镇粉丝产业园', 4.5, 1120, '15-100元', '龙口粉丝传统制作技艺是省级非遗，丝条匀细，纯净光亮，整齐柔韧，洁白透明。', '0535-8901234', '08:00-18:00', 0);-- 9. 博山菜 - 结合鲁菜非遗（鲁菜虽未单独列出，但属于山东传统饮食文化）INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('博山菜馆', '餐厅', NULL, '淄博市博山区', '淄博市', '博山区', '博山区中心路89号', 4.6, 1540, '60-400元', '博山菜是鲁菜的重要分支，四四席制、讲究礼仪，豆腐箱、酥锅、炸春卷等特色菜品闻名遐迩。', '0533-9012345', '11:00-14:30, 17:00-21:30', 1);-- 10. 单县羊肉汤 - 结合地方特色（虽非遗文档中无直接对应，但属于地方名吃）INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('单县羊肉汤老店', '餐厅', NULL, '菏泽市单县', '菏泽市', '单县', '单县湖西路26号', 4.8, 3250, '20-100元', '单县羊肉汤已有200多年历史，色白似奶，水脂交融，鲜而不膻，香而不腻，是山东传统名吃。', '0530-0123456', '06:00-21:00', 1);-- 11. 济南把子肉 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('超意兴把子肉', '快餐店', NULL, '济南市历下区', '济南市', '历下区', '历下区文化西路78号', 4.3, 4200, '15-40元', '济南把子肉肥而不腻，瘦而不柴，配以米饭、四喜丸子和炸鸡蛋，是济南标志性快餐。', '0531-1237890', '10:30-21:00', 1);-- 12. 潍坊朝天锅 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('韩邦朝天锅', '街边小吃', NULL, '潍坊市奎文区', '潍坊市', '奎文区', '奎文区东风东街345号', 4.4, 1860, '20-60元', '潍坊朝天锅源于清代乾隆年间，以饼卷猪头肉、猪杂为主，配以葱段、香菜和秘制酱料，热汤免费续饮。', '0536-2348901', '10:00-20:00', 1);-- 13. 青岛海鲜 - 结合海洋非遗文化INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('船歌鱼水饺', '餐厅',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%海洋号子%' OR project_name LIKE '%长岛渔号%'), '青岛市市南区', '青岛市', '市南区', '市南区闽江路12号', 4.7, 2890, '80-300元', '结合青岛海洋文化和渔家传统，以海鲜水饺为特色，墨鱼水饺、黄花鱼水饺等独具风味。', '0532-3459012', '11:00-22:00', 1);-- 14. 沂蒙煎饼 - 传统手工技艺INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('沂蒙煎饼坊', '街边小吃', NULL, '临沂市兰山区', '临沂市', '兰山区', '兰山区解放路156号', 4.1, 980, '5-30元', '沂蒙煎饼是革命老区的传统主食，以小米、玉米、地瓜等杂粮制成，薄如纸，柔似缎，可卷大葱、酱菜食用。', '0539-4560123', '06:00-19:00', 0);-- 15. 枣庄辣子鸡 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('枣庄辣子鸡总店', '餐厅', NULL, '枣庄市市中区', '枣庄市', '市中区', '市中区青檀路89号', 4.5, 1760, '60-200元', '枣庄辣子鸡选用本地小公鸡，配以大量青红辣椒和枣庄特色薄皮辣椒，麻辣鲜香，是鲁南地区代表菜。', '0632-5671234', '11:00-21:30', 1);-- 16. 聊城铁公鸡 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('魏氏熏鸡', '食品店', NULL, '聊城市东昌府区', '聊城市', '东昌府区', '东昌府区古楼西街34号', 4.3, 1240, '40-120元', '聊城铁公鸡（魏氏熏鸡）已有200多年历史，骨酥肉烂，熏香浓郁，可撕丝食用，是聊城特产。', '0635-6782345', '08:30-18:30', 0);-- 17. 滨州锅子饼 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('邢家锅子饼', '街边小吃', NULL, '滨州市滨城区', '滨州市', '滨城区', '滨城区渤海七路56号', 4.2, 890, '10-35元', '滨州锅子饼起源于清代，薄饼卷炒菜，外酥里嫩，有猪肉、牛肉、海鲜等多种馅料。', '0543-7893456', '09:00-20:00', 0);-- 18. 济宁甏肉干饭 - 地方特色美食INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('王家甏肉干饭', '快餐店', NULL, '济宁市任城区', '济宁市', '任城区', '任城区太白楼路78号', 4.6, 2150, '20-50元', '济宁甏肉干饭是传统快餐，甏肉肥而不腻，米饭用甏肉汤汁浇灌，配以卷煎、面筋、豆腐等。', '0537-8904567', '10:30-21:00', 1);-- 19. 烟台焖子 - 地方特色小吃INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('烟台焖子摊', '街边小吃', NULL, '烟台市芝罘区', '烟台市', '芝罘区', '芝罘区所城里老街', 4.0, 760, '8-20元', '烟台焖子以凉粉为主料，煎至金黄，配以芝麻酱、蒜汁、虾油等调料，是烟台特色街头小吃。', '0535-9015678', '10:00-20:00', 0);-- 20. 泰山三美 - 结合泰山豆腐非遗INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('泰山三美餐厅', '餐厅',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%豆腐传统制作技艺%'), '泰安市泰山区', '泰安市', '泰山区', '泰山区天外村路23号', 4.4, 680, '100-350元', '泰山三美指白菜、豆腐、水，用泰山泉水制作的豆腐宴，配以泰山白菜，体现泰山的饮食文化。', '0538-0126789', '11:00-21:00', 1);-- 21. 威海海鲜饺子 - 结合海洋文化INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('鲅鱼水饺店', '餐厅', NULL, '威海市环翠区', '威海市', '环翠区', '环翠区海滨北路45号', 4.5, 1420, '60-200元', '威海鲅鱼水饺是胶东特色，选用新鲜鲅鱼做馅，配以韭菜、猪肉，皮薄馅大，鲜美多汁。', '0631-1238901', '11:00-21:30', 1);-- 22. 日照绿茶 - 结合日照非遗（鲁南五大调）INSERT INTO intangible_heritage_food (food_name, food_type, heritage_id, location, city, district, address, rating, rating_count, price_range, special_features, contact_phone, opening_hours, is_recommended)VALUES('日照绿茶茶馆', '茶馆',  (SELECT TOP 1 heritage_id FROM intangible_cultural_heritage WHERE project_name LIKE '%鲁南五大调%' AND detail_url LIKE '%12645%'), '日照市东港区', '日照市', '东港区', '东港区海曲中路78号', 4.3, 540, '30-150元', '日照绿茶配以鲁南五大调表演，体验茶文化与民间音乐的结合，是日照特色文化体验场所。', '0633-2349012', '09:00-22:00', 0);GO-- 创建非遗餐饮视图CREATE VIEW vw_heritage_food_details ASSELECT     f.food_id,    f.food_name,    f.food_type,    f.location,    f.city,    f.district,    f.address,    f.rating,    f.rating_count,    f.price_range,    f.special_features,    f.contact_phone,    f.opening_hours,    f.is_recommended,    f.status,    h.project_name AS heritage_name,    c.category_name AS heritage_category,    h.batch AS heritage_batch,    f.created_timeFROM intangible_heritage_food fLEFT JOIN intangible_cultural_heritage h ON f.heritage_id = h.heritage_idLEFT JOIN categories c ON h.category_id = c.category_id;GO-- 创建非遗餐饮统计存储过程CREATE PROCEDURE sp_GetHeritageFoodStatisticsASBEGIN    -- 按类型统计    SELECT         '按餐饮类型统计' AS 统计类别,        food_type AS 类型,        COUNT(*) AS 数量,        STR(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM intangible_heritage_food), 5, 2) + '%' AS 占比    FROM intangible_heritage_food    GROUP BY food_type        UNION ALL        -- 按城市统计    SELECT         '按城市统计' AS 统计类别,        city AS 类型,        COUNT(*) AS 数量,        STR(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM intangible_heritage_food), 5, 2) + '%' AS 占比    FROM intangible_heritage_food    GROUP BY city        UNION ALL        -- 按推荐状态统计    SELECT         '按推荐状态统计' AS 统计类别,        CASE is_recommended WHEN 1 THEN '推荐' ELSE '未推荐' END AS 类型,        COUNT(*) AS 数量,        STR(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM intangible_heritage_food), 5, 2) + '%' AS 占比    FROM intangible_heritage_food    GROUP BY is_recommended        UNION ALL        -- 按非遗关联统计    SELECT         '按非遗关联统计' AS 统计类别,        CASE WHEN heritage_id IS NULL THEN '无非遗关联' ELSE '有非遗关联' END AS 类型,        COUNT(*) AS 数量,        STR(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM intangible_heritage_food), 5, 2) + '%' AS 占比    FROM intangible_heritage_food    GROUP BY CASE WHEN heritage_id IS NULL THEN '无非遗关联' ELSE '有非遗关联' END;END;GO-- 创建搜索非遗餐饮的存储过程CREATE PROCEDURE sp_SearchHeritageFood    @search_keyword VARCHAR(100) = NULL,    @city VARCHAR(50) = NULL,    @food_type VARCHAR(50) = NULL,    @min_rating DECIMAL(3,2) = NULLASBEGIN    SET NOCOUNT ON;        SELECT         f.food_id,        f.food_name,        f.food_type,        f.city,        f.district,        f.address,        f.rating,        f.rating_count,        f.price_range,        f.special_features,        f.is_recommended,        h.project_name AS heritage_name,        c.category_name AS heritage_category    FROM intangible_heritage_food f    LEFT JOIN intangible_cultural_heritage h ON f.heritage_id = h.heritage_id    LEFT JOIN categories c ON h.category_id = c.category_id    WHERE         (@search_keyword IS NULL OR          f.food_name LIKE '%' + @search_keyword + '%' OR          f.special_features LIKE '%' + @search_keyword + '%' OR         h.project_name LIKE '%' + @search_keyword + '%')        AND (@city IS NULL OR f.city = @city)        AND (@food_type IS NULL OR f.food_type = @food_type)        AND (@min_rating IS NULL OR f.rating >= @min_rating)    ORDER BY f.rating DESC, f.is_recommended DESC;END;GO-- 验证数据插入SELECT '非遗餐饮表数据' AS 表名, COUNT(*) AS 记录数 FROM intangible_heritage_food;-- 查看非遗餐饮详情SELECT TOP 10     food_id,    food_name,    food_type,    city + district AS 地区,    rating,    price_range,    is_recommended,    heritage_nameFROM vw_heritage_food_detailsORDER BY rating DESC, is_recommended DESC;-- 执行统计EXEC sp_GetHeritageFoodStatistics;-- 测试搜索EXEC sp_SearchHeritageFood @search_keyword = '鸡', @min_rating = 4.0;
